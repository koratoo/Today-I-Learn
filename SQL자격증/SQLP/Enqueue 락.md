

## 🔹 Enqueue란?

- 오라클은 리소스(자원) 보호를 위해 락을 거는데,  
- 이 락 중 일부는 단순한 **Spin Lock**이나 **Latch**처럼 짧은 시간 소모형 락이 아니라,  
- **명시적으로 기다리며 줄 서는(lock wait) 구조**를 갖는 락이 있어.  
- 이걸 **Enqueue**라고 불러.

**"enqueue" = 줄을 선다(queue에 들어간다)** → 이름 자체가 "줄 서서 기다리는 락"이라는 뜻이야.

---

## 🔹 Enqueue 락의 특징

| 항목 | 내용 |
|:-----|:-----|
| 목적 | 데이터 무결성 보장 (동시 수정 충돌 방지) |
| 방식 | 충돌 시 즉시 에러를 내지 않고 **줄 서서 기다림** |
| 사용 예시 | 트랜잭션 커밋 대기, 테이블 변경, 인덱스 생성, 테이블 잠금 등 |
| 종류 | TM 락(테이블), TX 락(트랜잭션), UL 락(사용자 정의 락) 등 다양한 종류 존재 |

---

## 🔹 Enqueue 락의 대표적인 종류

| 락 타입 | 설명 |
|:--------|:-----|
| **TX** | 트랜잭션 락 (Row-level lock 관리할 때) |
| **TM** | 테이블 락 (테이블 구조 변경, DML 충돌 방지) |
| **UL** | User Lock (애플리케이션이 직접 거는 사용자 락) |
| **SQ** | 시퀀스 락 (Sequence 객체 보호) |

특히 **TX 락**이 실무에서 제일 자주 문제가 돼. (예: Deadlock, Blocking)

---

## 🔹 Enqueue 락 발생 예시

예를 들어:

1. A 세션이 어떤 로우를 수정하고 커밋 안 한 상태야.
2. B 세션이 같은 로우를 수정하려고 해.
3. B는 즉시 에러가 나는 게 아니라, **A 세션이 커밋할 때까지 기다리는 상태**가 돼.
   - 이게 바로 **TX Enqueue 락**을 잡고 **Wait**하는 거야.

만약 A가 커밋하면 → B가 락을 얻어서 작업을 계속할 수 있어.  
A가 롤백하거나 문제가 생기면 → B가 에러를 받을 수도 있어.

---

## 🔹 Enqueue 관련 대기 이벤트 (Wait Event)

`v$session` 같은 동적 뷰를 보면 이런 이벤트로 대기하는 걸 볼 수 있어:

- `enq: TX - row lock contention`
- `enq: TM - contention`
- `enq: UL - contention`
  
이 이벤트는 **Enqueue를 잡으려고 기다리고 있는 상태**를 보여주는 거야.

---

## 🔹 요약

- **Enqueue** = 줄 서서 기다리는 락
- 주로 데이터 무결성 보호용
- TM, TX, UL 같은 여러 종류가 있음
- 대기 시간 길어지면 시스템 병목이 됨
- `v$session`, `v$lock`, `dba_blockers`, `dba_waiters` 뷰로 분석 가능
